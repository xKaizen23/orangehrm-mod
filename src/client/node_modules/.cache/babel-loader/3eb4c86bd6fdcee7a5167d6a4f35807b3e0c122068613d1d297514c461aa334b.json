{"ast":null,"code":"import { required, validSelection, validDateFormat, shouldNotExceedCharLength, endDateShouldBeAfterStartDate } from '@/core/util/validation/rules';\nimport { yearRange } from '@ohrm/core/util/helper/year-range';\nimport { diffInDays } from '@ohrm/core/util/helper/datefns';\nimport { APIService } from '@ohrm/core/util/services/api.service';\nimport LeaveTypeDropdown from '@/orangehrmLeavePlugin/components/LeaveTypeDropdown';\nimport LeaveDurationInput from '@/orangehrmLeavePlugin/components/LeaveDurationInput';\nimport LeaveBalance from '@/orangehrmLeavePlugin/components/LeaveBalance';\nimport EmployeeAutocomplete from '@/core/components/inputs/EmployeeAutocomplete';\nimport LeaveConflict from '@/orangehrmLeavePlugin/components/LeaveConflict';\nimport LeaveAssignConfirmModal from '@/orangehrmLeavePlugin/components/LeaveAssignConfirmModal';\nimport useLeaveValidators from '@/orangehrmLeavePlugin/util/composable/useLeaveValidators';\nimport useForm from '@ohrm/core/util/composable/useForm';\nimport useDateFormat from '@/core/util/composable/useDateFormat';\nconst leaveModel = {\n  employee: null,\n  type: null,\n  fromDate: null,\n  toDate: null,\n  comment: '',\n  partialOptions: null,\n  duration: {\n    type: null,\n    fromTime: null,\n    toTime: null\n  },\n  endDuration: {\n    type: null,\n    fromTime: null,\n    toTime: null\n  }\n};\nconst defaultWorkshift = {\n  startTime: '9:00',\n  endTime: '17:00'\n};\nexport default {\n  name: 'LeaveAssign',\n  components: {\n    'leave-type-dropdown': LeaveTypeDropdown,\n    'leave-duration-input': LeaveDurationInput,\n    'leave-balance': LeaveBalance,\n    'employee-autocomplete': EmployeeAutocomplete,\n    'leave-conflict': LeaveConflict,\n    'leave-assign-confirm-modal': LeaveAssignConfirmModal\n  },\n  setup() {\n    const http = new APIService(window.appGlobal.baseUrl, '/api/v2/leave/employees/leave-requests');\n    const {\n      serializeBody,\n      validateLeaveBalance,\n      validateOverlapLeaves\n    } = useLeaveValidators(http);\n    const {\n      formRef,\n      reset\n    } = useForm();\n    const {\n      userDateFormat\n    } = useDateFormat();\n    return {\n      http,\n      reset,\n      formRef,\n      serializeBody,\n      userDateFormat,\n      validateLeaveBalance,\n      validateOverlapLeaves\n    };\n  },\n  data() {\n    return {\n      isLoading: false,\n      leave: {\n        ...leaveModel\n      },\n      rules: {\n        type: [required],\n        fromDate: [required, validDateFormat(this.userDateFormat)],\n        toDate: [required, validDateFormat(this.userDateFormat), endDateShouldBeAfterStartDate(() => this.leave.fromDate, this.$t('general.to_date_should_be_after_from_date'), {\n          allowSameDate: true\n        })],\n        comment: [shouldNotExceedCharLength(250)],\n        employee: [required, validSelection]\n      },\n      partialOptions: [{\n        id: 1,\n        label: this.$t('leave.all_days'),\n        key: 'all'\n      }, {\n        id: 2,\n        label: this.$t('leave.start_day_only'),\n        key: 'start'\n      }, {\n        id: 3,\n        label: this.$t('leave.end_day_only'),\n        key: 'end'\n      }, {\n        id: 4,\n        label: this.$t('leave.start_and_end_day'),\n        key: 'start_end'\n      }],\n      showLeaveConflict: false,\n      isWorkShiftExceeded: false,\n      leaveConflictData: null,\n      yearsArray: [...yearRange()],\n      workShift: {\n        ...defaultWorkshift\n      }\n    };\n  },\n  computed: {\n    appliedLeaveDuration() {\n      return diffInDays(this.leave.fromDate, this.leave.toDate);\n    },\n    showDuration() {\n      const id = this.leave.partialOptions?.id;\n      return id && id === 1;\n    },\n    showStartDay() {\n      const id = this.leave.partialOptions?.id;\n      return id && (id === 2 || id === 4);\n    },\n    showEndDay() {\n      const id = this.leave.partialOptions?.id;\n      return id && (id === 3 || id === 4);\n    }\n  },\n  watch: {\n    'leave.employee': function (employee) {\n      if (employee?.id) {\n        this.http.request({\n          method: 'GET',\n          url: `/api/v2/pim/employees/${employee.id}/work-shift`\n        }).then(response => {\n          const {\n            data\n          } = response.data;\n          this.workShift = data;\n        });\n      } else {\n        this.workShift = {\n          ...defaultWorkshift\n        };\n      }\n    },\n    appliedLeaveDuration: function (duration) {\n      if (duration === 1) {\n        this.leave.duration.type = {\n          id: 1,\n          label: 'Full Day',\n          key: 'full_day'\n        };\n      } else {\n        this.leave.duration.type = null;\n      }\n    },\n    'leave.fromDate': function (fromDate) {\n      if (!fromDate || this.leave.toDate) return;\n      this.leave.toDate = fromDate;\n    }\n  },\n  methods: {\n    onSave() {\n      this.isLoading = true;\n      this.leaveConflictData = null;\n      this.showLeaveConflict = false;\n      this.validateLeaveBalance(this.leave).then(async ({\n        balance\n      }) => {\n        if (balance <= 0) {\n          const confirmation = await this.$refs.confirmDialog.showDialog();\n          if (confirmation !== 'ok') {\n            return Promise.reject();\n          }\n        }\n        return this.validateOverlapLeaves(this.leave);\n      }).then(({\n        isConflict,\n        isOverWorkshift,\n        data\n      }) => {\n        if (isConflict) {\n          this.leaveConflictData = data;\n          this.showLeaveConflict = true;\n          this.isWorkShiftExceeded = isOverWorkshift;\n          return Promise.reject();\n        }\n        return this.http.create(this.serializeBody(this.leave));\n      }).then(() => {\n        this.$toast.saveSuccess();\n        this.reset();\n      }).catch(() => {\n        this.showLeaveConflict && this.$toast.warn({\n          title: this.$t('general.warning'),\n          message: this.$t('leave.failed_to_submit')\n        });\n      }).finally(() => {\n        this.isLoading = false;\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["required","validSelection","validDateFormat","shouldNotExceedCharLength","endDateShouldBeAfterStartDate","yearRange","diffInDays","APIService","LeaveTypeDropdown","LeaveDurationInput","LeaveBalance","EmployeeAutocomplete","LeaveConflict","LeaveAssignConfirmModal","useLeaveValidators","useForm","useDateFormat","leaveModel","employee","type","fromDate","toDate","comment","partialOptions","duration","fromTime","toTime","endDuration","defaultWorkshift","startTime","endTime","name","components","setup","http","window","appGlobal","baseUrl","serializeBody","validateLeaveBalance","validateOverlapLeaves","formRef","reset","userDateFormat","data","isLoading","leave","rules","$t","allowSameDate","id","label","key","showLeaveConflict","isWorkShiftExceeded","leaveConflictData","yearsArray","workShift","computed","appliedLeaveDuration","showDuration","showStartDay","showEndDay","watch","request","method","url","then","response","methods","onSave","balance","confirmation","$refs","confirmDialog","showDialog","Promise","reject","isConflict","isOverWorkshift","create","$toast","saveSuccess","catch","warn","title","message","finally"],"sourceRoot":"","sources":["C:\\xampp\\htdocs\\orangehrm-5.7\\src\\client\\src\\orangehrmLeavePlugin\\pages\\LeaveAssign.vue"],"sourcesContent":["<!--\n/**\n * OrangeHRM is a comprehensive Human Resource Management (HRM) System that captures\n * all the essential functionalities required for any enterprise.\n * Copyright (C) 2006 OrangeHRM Inc., http://www.orangehrm.com\n *\n * OrangeHRM is free software: you can redistribute it and/or modify it under the terms of\n * the GNU General Public License as published by the Free Software Foundation, either\n * version 3 of the License, or (at your option) any later version.\n *\n * OrangeHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License along with OrangeHRM.\n * If not, see <https://www.gnu.org/licenses/>.\n */\n -->\n\n<template>\n  <div class=\"orangehrm-background-container\">\n    <leave-conflict\n      v-if=\"showLeaveConflict\"\n      :workshift-exceeded=\"isWorkShiftExceeded\"\n      :data=\"leaveConflictData\"\n    ></leave-conflict>\n    <leave-assign-confirm-modal ref=\"confirmDialog\">\n    </leave-assign-confirm-modal>\n    <div class=\"orangehrm-card-container\">\n      <oxd-text tag=\"h6\" class=\"orangehrm-main-title\">\n        {{ $t('leave.assign_leave') }}\n      </oxd-text>\n\n      <oxd-divider />\n\n      <oxd-form ref=\"formRef\" :loading=\"isLoading\" @submit-valid=\"onSave\">\n        <oxd-form-row>\n          <oxd-grid :cols=\"2\" class=\"orangehrm-full-width-grid\">\n            <oxd-grid-item>\n              <employee-autocomplete\n                v-model=\"leave.employee\"\n                :rules=\"rules.employee\"\n                required\n              />\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <oxd-form-row>\n          <oxd-grid :cols=\"2\" class=\"orangehrm-full-width-grid\">\n            <oxd-grid-item>\n              <leave-type-dropdown\n                v-model=\"leave.type\"\n                :rules=\"rules.type\"\n                :eligible-only=\"false\"\n                required\n              />\n            </oxd-grid-item>\n            <oxd-grid-item>\n              <leave-balance :leave-data=\"leave\"></leave-balance>\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <oxd-form-row>\n          <oxd-grid :cols=\"4\" class=\"orangehrm-full-width-grid\">\n            <oxd-grid-item>\n              <date-input\n                v-model=\"leave.fromDate\"\n                :label=\"$t('general.from_date')\"\n                :rules=\"rules.fromDate\"\n                :years=\"yearsArray\"\n                required\n              />\n            </oxd-grid-item>\n            <oxd-grid-item>\n              <date-input\n                v-model=\"leave.toDate\"\n                :label=\"$t('general.to_date')\"\n                :rules=\"rules.toDate\"\n                :years=\"yearsArray\"\n                required\n              />\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <!-- Single Day|Duration -->\n        <oxd-form-row v-if=\"appliedLeaveDuration == 1\">\n          <oxd-grid :cols=\"4\" class=\"orangehrm-full-width-grid\">\n            <leave-duration-input\n              v-model:duration=\"leave.duration.type\"\n              v-model:fromTime=\"leave.duration.fromTime\"\n              v-model:toTime=\"leave.duration.toTime\"\n              :label=\"$t('general.duration')\"\n              :work-shift=\"workShift\"\n            ></leave-duration-input>\n          </oxd-grid>\n        </oxd-form-row>\n        <!-- Single Day|Duration -->\n\n        <!-- Partial Day|Duration -->\n        <oxd-form-row v-if=\"appliedLeaveDuration > 1\">\n          <oxd-grid :cols=\"4\" class=\"orangehrm-full-width-grid\">\n            <oxd-grid-item>\n              <oxd-input-field\n                v-model=\"leave.partialOptions\"\n                type=\"select\"\n                :label=\"$t('leave.partial_days')\"\n                :options=\"partialOptions\"\n              />\n            </oxd-grid-item>\n            <leave-duration-input\n              v-if=\"showDuration\"\n              v-model:duration=\"leave.duration.type\"\n              v-model:fromTime=\"leave.duration.fromTime\"\n              v-model:toTime=\"leave.duration.toTime\"\n              :partial=\"true\"\n              :label=\"$t('general.duration')\"\n              :work-shift=\"workShift\"\n            ></leave-duration-input>\n            <leave-duration-input\n              v-if=\"showStartDay\"\n              v-model:duration=\"leave.duration.type\"\n              v-model:fromTime=\"leave.duration.fromTime\"\n              v-model:toTime=\"leave.duration.toTime\"\n              :partial=\"true\"\n              :label=\"$t('leave.start_day')\"\n              :work-shift=\"workShift\"\n            ></leave-duration-input>\n            <leave-duration-input\n              v-if=\"showEndDay\"\n              v-model:duration=\"leave.endDuration.type\"\n              v-model:fromTime=\"leave.endDuration.fromTime\"\n              v-model:toTime=\"leave.endDuration.toTime\"\n              :partial=\"true\"\n              :label=\"$t('leave.end_day')\"\n              :work-shift=\"workShift\"\n            ></leave-duration-input>\n          </oxd-grid>\n        </oxd-form-row>\n        <!-- Partial Day|Duration -->\n\n        <oxd-form-row>\n          <oxd-grid :cols=\"2\" class=\"orangehrm-full-width-grid\">\n            <oxd-grid-item>\n              <oxd-input-field\n                v-model=\"leave.comment\"\n                type=\"textarea\"\n                :label=\"$t('general.comments')\"\n                :rules=\"rules.comment\"\n              />\n            </oxd-grid-item>\n          </oxd-grid>\n        </oxd-form-row>\n\n        <oxd-divider />\n\n        <oxd-form-actions>\n          <required-text />\n          <submit-button :label=\"$t('leave.assign')\" />\n        </oxd-form-actions>\n      </oxd-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  required,\n  validSelection,\n  validDateFormat,\n  shouldNotExceedCharLength,\n  endDateShouldBeAfterStartDate,\n} from '@/core/util/validation/rules';\nimport {yearRange} from '@ohrm/core/util/helper/year-range';\nimport {diffInDays} from '@ohrm/core/util/helper/datefns';\nimport {APIService} from '@ohrm/core/util/services/api.service';\nimport LeaveTypeDropdown from '@/orangehrmLeavePlugin/components/LeaveTypeDropdown';\nimport LeaveDurationInput from '@/orangehrmLeavePlugin/components/LeaveDurationInput';\nimport LeaveBalance from '@/orangehrmLeavePlugin/components/LeaveBalance';\nimport EmployeeAutocomplete from '@/core/components/inputs/EmployeeAutocomplete';\nimport LeaveConflict from '@/orangehrmLeavePlugin/components/LeaveConflict';\nimport LeaveAssignConfirmModal from '@/orangehrmLeavePlugin/components/LeaveAssignConfirmModal';\nimport useLeaveValidators from '@/orangehrmLeavePlugin/util/composable/useLeaveValidators';\nimport useForm from '@ohrm/core/util/composable/useForm';\nimport useDateFormat from '@/core/util/composable/useDateFormat';\n\nconst leaveModel = {\n  employee: null,\n  type: null,\n  fromDate: null,\n  toDate: null,\n  comment: '',\n  partialOptions: null,\n  duration: {\n    type: null,\n    fromTime: null,\n    toTime: null,\n  },\n  endDuration: {\n    type: null,\n    fromTime: null,\n    toTime: null,\n  },\n};\n\nconst defaultWorkshift = {\n  startTime: '9:00',\n  endTime: '17:00',\n};\n\nexport default {\n  name: 'LeaveAssign',\n\n  components: {\n    'leave-type-dropdown': LeaveTypeDropdown,\n    'leave-duration-input': LeaveDurationInput,\n    'leave-balance': LeaveBalance,\n    'employee-autocomplete': EmployeeAutocomplete,\n    'leave-conflict': LeaveConflict,\n    'leave-assign-confirm-modal': LeaveAssignConfirmModal,\n  },\n\n  setup() {\n    const http = new APIService(\n      window.appGlobal.baseUrl,\n      '/api/v2/leave/employees/leave-requests',\n    );\n    const {serializeBody, validateLeaveBalance, validateOverlapLeaves} =\n      useLeaveValidators(http);\n    const {formRef, reset} = useForm();\n    const {userDateFormat} = useDateFormat();\n\n    return {\n      http,\n      reset,\n      formRef,\n      serializeBody,\n      userDateFormat,\n      validateLeaveBalance,\n      validateOverlapLeaves,\n    };\n  },\n\n  data() {\n    return {\n      isLoading: false,\n      leave: {...leaveModel},\n      rules: {\n        type: [required],\n        fromDate: [required, validDateFormat(this.userDateFormat)],\n        toDate: [\n          required,\n          validDateFormat(this.userDateFormat),\n          endDateShouldBeAfterStartDate(\n            () => this.leave.fromDate,\n            this.$t('general.to_date_should_be_after_from_date'),\n            {allowSameDate: true},\n          ),\n        ],\n        comment: [shouldNotExceedCharLength(250)],\n        employee: [required, validSelection],\n      },\n      partialOptions: [\n        {id: 1, label: this.$t('leave.all_days'), key: 'all'},\n        {id: 2, label: this.$t('leave.start_day_only'), key: 'start'},\n        {id: 3, label: this.$t('leave.end_day_only'), key: 'end'},\n        {id: 4, label: this.$t('leave.start_and_end_day'), key: 'start_end'},\n      ],\n      showLeaveConflict: false,\n      isWorkShiftExceeded: false,\n      leaveConflictData: null,\n      yearsArray: [...yearRange()],\n      workShift: {...defaultWorkshift},\n    };\n  },\n\n  computed: {\n    appliedLeaveDuration() {\n      return diffInDays(this.leave.fromDate, this.leave.toDate);\n    },\n    showDuration() {\n      const id = this.leave.partialOptions?.id;\n      return id && id === 1;\n    },\n    showStartDay() {\n      const id = this.leave.partialOptions?.id;\n      return id && (id === 2 || id === 4);\n    },\n    showEndDay() {\n      const id = this.leave.partialOptions?.id;\n      return id && (id === 3 || id === 4);\n    },\n  },\n\n  watch: {\n    'leave.employee': function (employee) {\n      if (employee?.id) {\n        this.http\n          .request({\n            method: 'GET',\n            url: `/api/v2/pim/employees/${employee.id}/work-shift`,\n          })\n          .then((response) => {\n            const {data} = response.data;\n            this.workShift = data;\n          });\n      } else {\n        this.workShift = {...defaultWorkshift};\n      }\n    },\n    appliedLeaveDuration: function (duration) {\n      if (duration === 1) {\n        this.leave.duration.type = {id: 1, label: 'Full Day', key: 'full_day'};\n      } else {\n        this.leave.duration.type = null;\n      }\n    },\n    'leave.fromDate': function (fromDate) {\n      if (!fromDate || this.leave.toDate) return;\n      this.leave.toDate = fromDate;\n    },\n  },\n\n  methods: {\n    onSave() {\n      this.isLoading = true;\n      this.leaveConflictData = null;\n      this.showLeaveConflict = false;\n\n      this.validateLeaveBalance(this.leave)\n        .then(async ({balance}) => {\n          if (balance <= 0) {\n            const confirmation = await this.$refs.confirmDialog.showDialog();\n            if (confirmation !== 'ok') {\n              return Promise.reject();\n            }\n          }\n          return this.validateOverlapLeaves(this.leave);\n        })\n        .then(({isConflict, isOverWorkshift, data}) => {\n          if (isConflict) {\n            this.leaveConflictData = data;\n            this.showLeaveConflict = true;\n            this.isWorkShiftExceeded = isOverWorkshift;\n            return Promise.reject();\n          }\n          return this.http.create(this.serializeBody(this.leave));\n        })\n        .then(() => {\n          this.$toast.saveSuccess();\n          this.reset();\n        })\n        .catch(() => {\n          this.showLeaveConflict &&\n            this.$toast.warn({\n              title: this.$t('general.warning'),\n              message: this.$t('leave.failed_to_submit'),\n            });\n        })\n        .finally(() => {\n          this.isLoading = false;\n        });\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}