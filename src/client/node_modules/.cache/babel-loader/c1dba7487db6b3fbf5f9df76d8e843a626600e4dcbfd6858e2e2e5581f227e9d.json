{"ast":null,"code":"import { toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, renderSlot as _renderSlot, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, createSlots as _createSlots, createElementVNode as _createElementVNode, vShow as _vShow, withDirectives as _withDirectives, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-7a817506\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"orangehrm-buzz-newsfeed\"\n};\nconst _hoisted_2 = [\"src\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_oxd_text = _resolveComponent(\"oxd-text\");\n  const _component_create_post = _resolveComponent(\"create-post\");\n  const _component_post_body = _resolveComponent(\"post-body\");\n  const _component_post_actions = _resolveComponent(\"post-actions\");\n  const _component_post_stats = _resolveComponent(\"post-stats\");\n  const _component_oxd_divider = _resolveComponent(\"oxd-divider\");\n  const _component_post_comment_container = _resolveComponent(\"post-comment-container\");\n  const _component_post_container = _resolveComponent(\"post-container\");\n  const _component_oxd_grid_item = _resolveComponent(\"oxd-grid-item\");\n  const _component_oxd_grid = _resolveComponent(\"oxd-grid\");\n  const _component_oxd_loading_spinner = _resolveComponent(\"oxd-loading-spinner\");\n  const _component_edit_post_modal = _resolveComponent(\"edit-post-modal\");\n  const _component_share_post_modal = _resolveComponent(\"share-post-modal\");\n  const _component_photo_carousel = _resolveComponent(\"photo-carousel\");\n  const _component_delete_confirmation = _resolveComponent(\"delete-confirmation\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_oxd_text, {\n    type: \"card-title\",\n    class: \"orangehrm-buzz-newsfeed-title\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(_toDisplayString(_ctx.$t('buzz.buzz_newsfeed')), 1)]),\n    _: 1\n  }), (_openBlock(), _createBlock(_component_create_post, {\n    key: _ctx.posts,\n    employee: $props.employee,\n    onRefresh: $setup.resetFeed\n  }, null, 8, [\"employee\", \"onRefresh\"])), _renderSlot(_ctx.$slots, \"default\", {}, undefined, true), _createVNode(_component_oxd_grid, {\n    cols: 1,\n    class: \"orangehrm-buzz-newsfeed-posts\"\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.posts, (post, index) => {\n      return _openBlock(), _createBlock(_component_oxd_grid_item, {\n        key: post\n      }, {\n        default: _withCtx(() => [_createVNode(_component_post_container, {\n          post: post,\n          onEdit: $event => $setup.onEdit(index),\n          onDelete: $event => $setup.onDelete(index)\n        }, _createSlots({\n          content: _withCtx(() => [_createVNode(_component_post_body, {\n            post: post,\n            onSelectPhoto: $event => $setup.onSelectPhoto($event, index)\n          }, null, 8, [\"post\", \"onSelectPhoto\"])]),\n          actionButton: _withCtx(() => [_createVNode(_component_post_actions, {\n            post: post,\n            onLike: $event => $setup.onLike(index),\n            onShare: $event => $setup.onShare(index),\n            onComment: $event => $setup.onComment(index)\n          }, null, 8, [\"post\", \"onLike\", \"onShare\", \"onComment\"])]),\n          postStats: _withCtx(() => [_createVNode(_component_post_stats, {\n            post: post,\n            mobile: $props.mobile,\n            onComment: $event => $setup.onComment(index)\n          }, null, 8, [\"post\", \"mobile\", \"onComment\"])]),\n          _: 2\n        }, [post.showComments ? {\n          name: \"comments\",\n          fn: _withCtx(() => [_createVNode(_component_oxd_divider), _createVNode(_component_post_comment_container, {\n            \"post-id\": post.id,\n            employee: $props.employee,\n            onCreate: $event => $setup.onCreateComment(index),\n            onDelete: $event => $setup.onDeleteComment(index)\n          }, null, 8, [\"post-id\", \"employee\", \"onCreate\", \"onDelete\"])]),\n          key: \"0\"\n        } : undefined]), 1032, [\"post\", \"onEdit\", \"onDelete\"])]),\n        _: 2\n      }, 1024);\n    }), 128)), _withDirectives(_createVNode(_component_oxd_grid_item, {\n      class: \"orangehrm-buzz-newsfeed-noposts\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"img\", {\n        src: $setup.noPostsPic,\n        alt: \"No Posts\"\n      }, null, 8, _hoisted_2), _createVNode(_component_oxd_text, {\n        tag: \"p\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString(_ctx.$t('buzz.no_posts_available')), 1)]),\n        _: 1\n      })]),\n      _: 1\n    }, 512), [[_vShow, !_ctx.isLoading && _ctx.posts.length === 0]])]),\n    _: 1\n  }), _ctx.isLoading ? (_openBlock(), _createBlock(_component_oxd_loading_spinner, {\n    key: 0,\n    class: \"orangehrm-buzz-newsfeed-loader\"\n  })) : _createCommentVNode(\"\", true)]), _ctx.showEditModal ? (_openBlock(), _createBlock(_component_edit_post_modal, {\n    key: 0,\n    employee: $props.employee,\n    data: _ctx.editModalState.post,\n    onClose: $setup.onCloseEditModal\n  }, null, 8, [\"employee\", \"data\", \"onClose\"])) : _createCommentVNode(\"\", true), _ctx.showShareModal ? (_openBlock(), _createBlock(_component_share_post_modal, {\n    key: 1,\n    employee: $props.employee,\n    data: _ctx.shareModalState,\n    onClose: $setup.onCloseShareModal\n  }, null, 8, [\"employee\", \"data\", \"onClose\"])) : _createCommentVNode(\"\", true), _ctx.showPhotoCarousel ? (_openBlock(), _createBlock(_component_photo_carousel, {\n    key: 2,\n    mobile: $props.mobile,\n    post: _ctx.photoCarouselState.post,\n    \"photo-index\": _ctx.photoCarouselState.photoIndex,\n    onClose: $setup.onClosePhotoCarousel,\n    onLike: _cache[0] || (_cache[0] = $event => $setup.onLike(_ctx.photoCarouselState.postIndex)),\n    onCreateComment: _cache[1] || (_cache[1] = $event => $setup.onCreateComment(_ctx.photoCarouselState.postIndex)),\n    onDeleteComment: _cache[2] || (_cache[2] = $event => $setup.onDeleteComment(_ctx.photoCarouselState.postIndex))\n  }, null, 8, [\"mobile\", \"post\", \"photo-index\", \"onClose\"])) : _createCommentVNode(\"\", true), _createVNode(_component_delete_confirmation, {\n    ref: \"deleteDialog\",\n    message: _ctx.$t('buzz.post_delete_confirmation_message')\n  }, null, 8, [\"message\"])], 64);\n}","map":{"version":3,"mappings":";;;EAoBOA,KAAK,EAAC;AAAyB;;;;;;;;;;;;;;;;;;6DAApCC,oBAkEM,OAlENC,UAkEM,GAjEJC,aAEWC;IAFDC,IAAI,EAAC,YAAY;IAACL,KAAK,EAAC;;sBAChC,MAA8B,mCAA3BM,OAAE;;qBAGPC,aAIeC;IAHZC,GAAG,EAAEH,UAAK;IACVI,QAAQ,EAAEC,eAAQ;IAClBC,SAAO,EAAEC;2CAEZC,YAAaR,8CAEbH,aAiDWY;IAjDAC,IAAI,EAAE,CAAC;IAAEhB,KAAK,EAAC;;sBACT,MAA8B,oBAA7CiB,oBAqCgBC,6BArCuBZ,UAAK,GAArBa,IAAI,EAAEC,KAAK;2BAAlCb,aAqCgBc;QArC+BZ,GAAG,EAAEU;MAAI;0BACtD,MAmCiB,CAnCjBhB,aAmCiBmB;UAlCdH,IAAI,EAAEA,IAAI;UACVI,MAAI,YAAEV,aAAM,CAACO,KAAK;UAClBI,QAAM,YAAEX,eAAQ,CAACO,KAAK;;UAEZK,OAAO,WAChB,MAGa,CAHbtB,aAGauB;YAFVP,IAAI,EAAEA,IAAI;YACVQ,aAAY,YAAEd,oBAAa,CAACe,MAAM,EAAER,KAAK;;UAGnCS,YAAY,WACrB,MAKgB,CALhB1B,aAKgB2B;YAJbX,IAAI,EAAEA,IAAI;YACVY,MAAI,YAAElB,aAAM,CAACO,KAAK;YAClBY,OAAK,YAAEnB,cAAO,CAACO,KAAK;YACpBa,SAAO,YAAEpB,gBAAS,CAACO,KAAK;;UAGlBc,SAAS,WAClB,MAIc,CAJd/B,aAIcgC;YAHXhB,IAAI,EAAEA,IAAI;YACViB,MAAM,EAAEzB,aAAM;YACdsB,SAAO,YAAEpB,gBAAS,CAACO,KAAK;;;YAGbD,IAAI,CAACkB,YAAY;gBAAG,UAAQ;uBAC1C,MAAe,CAAflC,aAAemC,yBACfnC,aAK0BoC;YAJvB,SAAO,EAAEpB,IAAI,CAACqB,EAAE;YAChB9B,QAAQ,EAAEC,eAAQ;YAClB8B,QAAM,YAAE5B,sBAAe,CAACO,KAAK;YAC7BI,QAAM,YAAEX,sBAAe,CAACO,KAAK;;;;;;+BAMtCjB,aAQgBkB;MANdrB,KAAK,EAAC;IAAiC;wBAEvC,MAAwC,CAAxCC,oBAAwC;QAAlCyC,GAAG,EAAE7B,iBAAU;QAAE8B,GAAG,EAAC;+BAC3BxC,aAEWC;QAFDwC,GAAG,EAAC;MAAG;0BACf,MAAmC,mCAAhCtC,OAAE;;;;wBALEA,cAAS,IAAIA,UAAK,CAACuC,MAAM;;MAU9BvC,cAAS,kBADjBC,aAGEuC;;IADA9C,KAAK,EAAC;yCAKFM,kBAAa,kBADrBC,aAKmBwC;;IAHhBrC,QAAQ,EAAEC,eAAQ;IAClBqC,IAAI,EAAE1C,mBAAc,CAACa,IAAI;IACzB8B,OAAK,EAAEpC;iFAGFP,mBAAc,kBADtBC,aAKoB2C;;IAHjBxC,QAAQ,EAAEC,eAAQ;IAClBqC,IAAI,EAAE1C,oBAAe;IACrB2C,OAAK,EAAEpC;iFAGFP,sBAAiB,kBADzBC,aASkB4C;;IAPff,MAAM,EAAEzB,aAAM;IACdQ,IAAI,EAAEb,uBAAkB,CAACa,IAAI;IAC7B,aAAW,EAAEb,uBAAkB,CAAC8C,UAAU;IAC1CH,OAAK,EAAEpC,2BAAoB;IAC3BkB,MAAI,sCAAElB,aAAM,CAACP,uBAAkB,CAAC+C,SAAS;IACzCC,eAAc,sCAAEzC,sBAAe,CAACP,uBAAkB,CAAC+C,SAAS;IAC5DE,eAAc,sCAAE1C,sBAAe,CAACP,uBAAkB,CAAC+C,SAAS;8FAE/DlD,aAGuBqD;IAFrBC,GAAG,EAAC,cAAc;IACjBC,OAAO,EAAEpD,OAAE","names":["class","_createElementVNode","_hoisted_1","_createVNode","_component_oxd_text","type","_ctx","_createBlock","_component_create_post","key","employee","$props","onRefresh","$setup","_renderSlot","_component_oxd_grid","cols","_createElementBlock","_Fragment","post","index","_component_oxd_grid_item","_component_post_container","onEdit","onDelete","content","_component_post_body","onSelectPhoto","$event","actionButton","_component_post_actions","onLike","onShare","onComment","postStats","_component_post_stats","mobile","showComments","_component_oxd_divider","_component_post_comment_container","id","onCreate","src","alt","tag","length","_component_oxd_loading_spinner","_component_edit_post_modal","data","onClose","_component_share_post_modal","_component_photo_carousel","photoIndex","postIndex","onCreateComment","onDeleteComment","_component_delete_confirmation","ref","message"],"sourceRoot":"","sources":["C:\\xampp\\htdocs\\orangehrm-5.7\\src\\client\\src\\orangehrmBuzzPlugin\\components\\NewsFeed.vue"],"sourcesContent":["<!--\n/**\n * OrangeHRM is a comprehensive Human Resource Management (HRM) System that captures\n * all the essential functionalities required for any enterprise.\n * Copyright (C) 2006 OrangeHRM Inc., http://www.orangehrm.com\n *\n * OrangeHRM is free software: you can redistribute it and/or modify it under the terms of\n * the GNU General Public License as published by the Free Software Foundation, either\n * version 3 of the License, or (at your option) any later version.\n *\n * OrangeHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License along with OrangeHRM.\n * If not, see <https://www.gnu.org/licenses/>.\n */\n -->\n\n<template>\n  <div class=\"orangehrm-buzz-newsfeed\">\n    <oxd-text type=\"card-title\" class=\"orangehrm-buzz-newsfeed-title\">\n      {{ $t('buzz.buzz_newsfeed') }}\n    </oxd-text>\n\n    <create-post\n      :key=\"posts\"\n      :employee=\"employee\"\n      @refresh=\"resetFeed\"\n    ></create-post>\n    <slot></slot>\n\n    <oxd-grid :cols=\"1\" class=\"orangehrm-buzz-newsfeed-posts\">\n      <oxd-grid-item v-for=\"(post, index) in posts\" :key=\"post\">\n        <post-container\n          :post=\"post\"\n          @edit=\"onEdit(index)\"\n          @delete=\"onDelete(index)\"\n        >\n          <template #content>\n            <post-body\n              :post=\"post\"\n              @select-photo=\"onSelectPhoto($event, index)\"\n            ></post-body>\n          </template>\n          <template #actionButton>\n            <post-actions\n              :post=\"post\"\n              @like=\"onLike(index)\"\n              @share=\"onShare(index)\"\n              @comment=\"onComment(index)\"\n            ></post-actions>\n          </template>\n          <template #postStats>\n            <post-stats\n              :post=\"post\"\n              :mobile=\"mobile\"\n              @comment=\"onComment(index)\"\n            ></post-stats>\n          </template>\n          <template v-if=\"post.showComments\" #comments>\n            <oxd-divider />\n            <post-comment-container\n              :post-id=\"post.id\"\n              :employee=\"employee\"\n              @create=\"onCreateComment(index)\"\n              @delete=\"onDeleteComment(index)\"\n            ></post-comment-container>\n          </template>\n        </post-container>\n      </oxd-grid-item>\n\n      <oxd-grid-item\n        v-show=\"!isLoading && posts.length === 0\"\n        class=\"orangehrm-buzz-newsfeed-noposts\"\n      >\n        <img :src=\"noPostsPic\" alt=\"No Posts\" />\n        <oxd-text tag=\"p\">\n          {{ $t('buzz.no_posts_available') }}\n        </oxd-text>\n      </oxd-grid-item>\n    </oxd-grid>\n    <oxd-loading-spinner\n      v-if=\"isLoading\"\n      class=\"orangehrm-buzz-newsfeed-loader\"\n    />\n  </div>\n\n  <edit-post-modal\n    v-if=\"showEditModal\"\n    :employee=\"employee\"\n    :data=\"editModalState.post\"\n    @close=\"onCloseEditModal\"\n  ></edit-post-modal>\n  <share-post-modal\n    v-if=\"showShareModal\"\n    :employee=\"employee\"\n    :data=\"shareModalState\"\n    @close=\"onCloseShareModal\"\n  ></share-post-modal>\n  <photo-carousel\n    v-if=\"showPhotoCarousel\"\n    :mobile=\"mobile\"\n    :post=\"photoCarouselState.post\"\n    :photo-index=\"photoCarouselState.photoIndex\"\n    @close=\"onClosePhotoCarousel\"\n    @like=\"onLike(photoCarouselState.postIndex)\"\n    @create-comment=\"onCreateComment(photoCarouselState.postIndex)\"\n    @delete-comment=\"onDeleteComment(photoCarouselState.postIndex)\"\n  ></photo-carousel>\n  <delete-confirmation\n    ref=\"deleteDialog\"\n    :message=\"$t('buzz.post_delete_confirmation_message')\"\n  ></delete-confirmation>\n</template>\n\n<script>\nimport useToast from '@/core/util/composable/useToast';\nimport {APIService} from '@/core/util/services/api.service';\nimport {onBeforeMount, reactive, ref, toRefs, watch} from 'vue';\nimport PostBody from '@/orangehrmBuzzPlugin/components/PostBody.vue';\nimport PostStats from '@/orangehrmBuzzPlugin/components/PostStats.vue';\nimport CreatePost from '@/orangehrmBuzzPlugin/components/CreatePost.vue';\nimport useInfiniteScroll from '@/core/util/composable/useInfiniteScroll';\nimport PostActions from '@/orangehrmBuzzPlugin/components/PostActions.vue';\nimport useBuzzAPIs from '@/orangehrmBuzzPlugin/util/composable/useBuzzAPIs';\nimport EditPostModal from '@/orangehrmBuzzPlugin/components/EditPostModal.vue';\nimport PhotoCarousel from '@/orangehrmBuzzPlugin/components/PhotoCarousel.vue';\nimport PostContainer from '@/orangehrmBuzzPlugin/components/PostContainer.vue';\nimport SharePostModal from '@/orangehrmBuzzPlugin/components/SharePostModal.vue';\nimport DeleteConfirmationDialog from '@ohrm/components/dialogs/DeleteConfirmationDialog';\nimport PostCommentContainer from '@/orangehrmBuzzPlugin/components/PostCommentContainer.vue';\nimport {OxdSpinner} from '@ohrm/oxd';\n\nexport default {\n  name: 'NewsFeed',\n\n  components: {\n    'post-body': PostBody,\n    'post-stats': PostStats,\n    'create-post': CreatePost,\n    'post-actions': PostActions,\n    'oxd-loading-spinner': OxdSpinner,\n    'photo-carousel': PhotoCarousel,\n    'post-container': PostContainer,\n    'edit-post-modal': EditPostModal,\n    'share-post-modal': SharePostModal,\n    'post-comment-container': PostCommentContainer,\n    'delete-confirmation': DeleteConfirmationDialog,\n  },\n\n  props: {\n    employee: {\n      type: Object,\n      required: true,\n    },\n    sortField: {\n      type: String,\n      required: true,\n    },\n    mobile: {\n      type: Boolean,\n      default: false,\n    },\n  },\n\n  setup(props) {\n    const POST_LIMIT = 10;\n    const deleteDialog = ref();\n    const {deleteSuccess} = useToast();\n    const {fetchPosts, deletePost} = useBuzzAPIs(\n      new APIService(window.appGlobal.baseUrl, ''),\n    );\n    const noPostsPic = `${window.appGlobal.publicPath}/images/buzz_no_posts.svg`;\n\n    const state = reactive({\n      total: 0,\n      offset: 0,\n      posts: [],\n      isLoading: false,\n      showEditModal: false,\n      editModalState: null,\n      showShareModal: false,\n      shareModalState: null,\n      showPhotoCarousel: false,\n      photoCarouselState: null,\n    });\n\n    const fetchData = () => {\n      state.isLoading = true;\n      fetchPosts(POST_LIMIT, state.offset, 'DESC', props.sortField)\n        .then((response) => {\n          const {data, meta} = response.data;\n          state.total = meta.total || 0;\n          if (Array.isArray(data)) {\n            state.posts = [...state.posts, ...data];\n          }\n        })\n        .finally(() => (state.isLoading = false));\n    };\n\n    useInfiniteScroll(() => {\n      if (state.posts.length >= state.total) return;\n      state.offset += POST_LIMIT;\n      fetchData();\n    });\n\n    const onLike = (index) => {\n      state.posts[index].liked = !state.posts[index].liked;\n      if (state.posts[index].liked) {\n        state.posts[index].stats.numOfLikes++;\n      } else {\n        state.posts[index].stats.numOfLikes--;\n      }\n    };\n\n    const onEdit = (index) => {\n      state.showEditModal = true;\n      state.editModalState = {\n        postIndex: index,\n        post: state.posts[index],\n      };\n      document.body.style.overflow = 'hidden';\n    };\n\n    const onShare = (index) => {\n      state.showShareModal = true;\n      state.shareModalState = state.posts[index];\n      document.body.style.overflow = 'hidden';\n    };\n\n    const onComment = (index) => {\n      if (state.posts[index].showComments) {\n        state.posts[index].showComments = false;\n      } else {\n        state.posts[index].showComments = true;\n      }\n    };\n\n    const resetFeed = () => {\n      state.posts = [];\n      state.offset = 0;\n      fetchData();\n    };\n\n    const onSelectPhoto = ($event, index) => {\n      state.photoCarouselState = {\n        postIndex: index,\n        photoIndex: $event,\n        post: state.posts[index],\n      };\n      state.showPhotoCarousel = true;\n      document.body.style.overflow = 'hidden';\n    };\n\n    const onClosePhotoCarousel = () => {\n      state.showPhotoCarousel = false;\n      state.photoCarouselState = null;\n      document.body.style.overflow = 'auto';\n    };\n\n    const onCloseShareModal = ($event) => {\n      state.showShareModal = false;\n      state.shareModalState = null;\n      document.body.style.overflow = 'auto';\n      if ($event) resetFeed();\n    };\n\n    const onCloseEditModal = ($event) => {\n      const {data} = $event;\n      if (data) state.posts[state.editModalState.postIndex] = {...data};\n      state.showEditModal = false;\n      state.editModalState = null;\n      document.body.style.overflow = 'auto';\n    };\n\n    const onDelete = (index) => {\n      deleteDialog.value.showDialog().then((confirmation) => {\n        if (confirmation === 'ok') {\n          deletePost(state.posts[index].id).then(() => {\n            resetFeed();\n            deleteSuccess();\n          });\n        }\n      });\n    };\n\n    const onCreateComment = (index) => {\n      state.posts[index].stats.numOfComments++;\n    };\n\n    const onDeleteComment = (index) => {\n      state.posts[index].stats.numOfComments--;\n    };\n\n    onBeforeMount(() => fetchData());\n\n    watch(\n      () => props.sortField,\n      () => {\n        state.posts = [];\n        state.offset = 0;\n        fetchData();\n      },\n    );\n\n    return {\n      onLike,\n      onEdit,\n      onShare,\n      onDelete,\n      resetFeed,\n      onComment,\n      noPostsPic,\n      deleteDialog,\n      onSelectPhoto,\n      onCreateComment,\n      onDeleteComment,\n      onCloseEditModal,\n      onCloseShareModal,\n      onClosePhotoCarousel,\n      ...toRefs(state),\n    };\n  },\n};\n</script>\n\n<style src=\"./news-feed.scss\" lang=\"scss\" scoped></style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}