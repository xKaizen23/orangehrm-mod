{"ast":null,"code":"import useForm from '@ohrm/core/util/composable/useForm';\nimport { APIService } from '@/core/util/services/api.service';\nimport { navigate, reloadPage } from '@/core/util/helper/navigation';\nimport ReviewSummary from '@/orangehrmPerformancePlugin/components/ReviewSummary';\nimport FinalEvaluation from '@/orangehrmPerformancePlugin/components/FinalEvaluation';\nimport EvaluationForm from '@/orangehrmPerformancePlugin/components/EvaluationForm';\nimport useReviewEvaluation from '@/orangehrmPerformancePlugin/util/composable/useReviewEvaluation';\nimport ReviewConfirmModal from '@/orangehrmPerformancePlugin/components/ReviewConfirmModal';\nconst reviewerModel = {\n  details: {\n    empNumber: null,\n    firstName: '',\n    lastName: '',\n    middleName: '',\n    terminationId: null\n  },\n  jobTitle: '',\n  status: 1,\n  actions: new Map()\n};\nexport default {\n  components: {\n    'review-summary': ReviewSummary,\n    'final-evaluation': FinalEvaluation,\n    'evaluation-form': EvaluationForm,\n    'review-confirm-modal': ReviewConfirmModal\n  },\n  props: {\n    reviewId: {\n      type: Number,\n      required: true\n    },\n    status: {\n      type: Number,\n      required: true\n    },\n    reviewPeriodStart: {\n      type: String,\n      required: true\n    },\n    reviewPeriodEnd: {\n      type: String,\n      required: true\n    },\n    dueDate: {\n      type: String,\n      required: true\n    },\n    isReviewer: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup() {\n    const {\n      formRef,\n      invalid,\n      validate\n    } = useForm();\n    const http = new APIService(window.appGlobal.baseUrl, '');\n    const {\n      getAllKpis,\n      getEmployeeReview,\n      getSupervisorReview,\n      getFinalReview,\n      generateRules,\n      generateModel,\n      generateReviewerData,\n      generateAllowedActions,\n      generateEvaluationFormData,\n      finalizeReview,\n      saveEmployeeReview,\n      saveSupervisorReview\n    } = useReviewEvaluation(http);\n    return {\n      http,\n      invalid,\n      formRef,\n      validate,\n      getAllKpis,\n      generateRules,\n      generateModel,\n      generateReviewerData,\n      generateAllowedActions,\n      generateEvaluationFormData,\n      getEmployeeReview,\n      getSupervisorReview,\n      getFinalReview,\n      finalizeReview,\n      saveEmployeeReview,\n      saveSupervisorReview\n    };\n  },\n  data() {\n    return {\n      kpis: [],\n      rules: [],\n      employee: {\n        ...reviewerModel\n      },\n      employeeReview: {},\n      supervisor: {\n        ...reviewerModel\n      },\n      supervisorReview: {},\n      isLoading: false,\n      finalRating: null,\n      finalComment: null,\n      completedDate: null,\n      isFinalizeRequired: false\n    };\n  },\n  computed: {\n    hasSupervisorUpdateAction() {\n      return this.employee.actions.has('supervisorUpdate');\n    },\n    hasSaveAction() {\n      return this.supervisor.actions.has('save');\n    },\n    hasCompleteAction() {\n      return this.supervisor.actions.has('complete');\n    },\n    hasCancelAction() {\n      return this.status !== 4;\n    },\n    hasActions() {\n      return this.hasSupervisorUpdateAction || this.hasSaveAction || this.hasCompleteAction || this.hasCancelAction;\n    }\n  },\n  beforeMount() {\n    this.isLoading = true;\n    this.getAllKpis(this.reviewId).then(response => {\n      const {\n        data\n      } = response.data;\n      this.kpis = [...data];\n      this.rules = this.generateRules(data);\n      this.employeeReview = this.generateModel(data);\n      this.supervisorReview = this.generateModel(data);\n      return this.getEmployeeReview(this.reviewId);\n    }).then(response => {\n      const {\n        data\n      } = response.data;\n      const {\n        meta\n      } = response.data;\n      this.employee = this.generateReviewerData(meta.reviewer);\n      this.employee.actions = this.generateAllowedActions(meta.allowedActions);\n      this.employeeReview = this.generateEvaluationFormData(data, meta.generalComment, this.employeeReview.kpis);\n      return this.getSupervisorReview(this.reviewId);\n    }).then(response => {\n      const {\n        data\n      } = response.data;\n      const {\n        meta\n      } = response.data;\n      this.supervisor = this.generateReviewerData(meta.reviewer);\n      this.supervisor.actions = this.generateAllowedActions(meta.allowedActions);\n      this.supervisorReview = this.generateEvaluationFormData(data, meta.generalComment, this.supervisorReview.kpis);\n      return this.getFinalReview(this.reviewId);\n    }).then(response => {\n      const {\n        data\n      } = response.data;\n      this.finalRating = data.finalRating;\n      this.finalComment = data.finalComment;\n      this.completedDate = data.completedDate;\n    }).finally(() => {\n      this.isLoading = false;\n    });\n  },\n  methods: {\n    onSubmit(complete = false) {\n      this.isFinalizeRequired = complete;\n      this.$nextTick().then(() => this.validate()).then(() => {\n        if (this.invalid === true) return;\n        if (complete) {\n          this.$refs.confirmDialog.showDialog().then(confirmation => {\n            if (confirmation === 'ok') {\n              this.submitReview(true);\n            }\n          });\n        } else {\n          this.submitReview(false);\n        }\n      });\n    },\n    submitReview(complete = false) {\n      this.isLoading = true;\n      this.saveSupervisorReview(this.reviewId, this.supervisorReview).then(() => {\n        if (this.hasSupervisorUpdateAction) {\n          return this.saveEmployeeReview(this.reviewId, true, this.employeeReview);\n        }\n      }).then(() => {\n        return this.finalizeReview(this.reviewId, {\n          complete: complete,\n          finalRating: this.finalRating,\n          finalComment: this.finalComment,\n          completedDate: this.completedDate\n        });\n      }).then(() => {\n        return this.$toast.saveSuccess();\n      }).finally(() => {\n        reloadPage();\n      });\n    },\n    onClickCancel() {\n      navigate(this.isReviewer ? '/performance/searchEvaluatePerformanceReview' : '/performance/searchPerformanceReview');\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["useForm","APIService","navigate","reloadPage","ReviewSummary","FinalEvaluation","EvaluationForm","useReviewEvaluation","ReviewConfirmModal","reviewerModel","details","empNumber","firstName","lastName","middleName","terminationId","jobTitle","status","actions","Map","components","props","reviewId","type","Number","required","reviewPeriodStart","String","reviewPeriodEnd","dueDate","isReviewer","Boolean","default","setup","formRef","invalid","validate","http","window","appGlobal","baseUrl","getAllKpis","getEmployeeReview","getSupervisorReview","getFinalReview","generateRules","generateModel","generateReviewerData","generateAllowedActions","generateEvaluationFormData","finalizeReview","saveEmployeeReview","saveSupervisorReview","data","kpis","rules","employee","employeeReview","supervisor","supervisorReview","isLoading","finalRating","finalComment","completedDate","isFinalizeRequired","computed","hasSupervisorUpdateAction","has","hasSaveAction","hasCompleteAction","hasCancelAction","hasActions","beforeMount","then","response","meta","reviewer","allowedActions","generalComment","finally","methods","onSubmit","complete","$nextTick","$refs","confirmDialog","showDialog","confirmation","submitReview","$toast","saveSuccess","onClickCancel"],"sourceRoot":"","sources":["C:\\xampp\\htdocs\\orangehrm-5.7\\src\\client\\src\\orangehrmPerformancePlugin\\pages\\AdminEvaluation.vue"],"sourcesContent":["<!--\n/**\n * OrangeHRM is a comprehensive Human Resource Management (HRM) System that captures\n * all the essential functionalities required for any enterprise.\n * Copyright (C) 2006 OrangeHRM Inc., http://www.orangehrm.com\n *\n * OrangeHRM is free software: you can redistribute it and/or modify it under the terms of\n * the GNU General Public License as published by the Free Software Foundation, either\n * version 3 of the License, or (at your option) any later version.\n *\n * OrangeHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License along with OrangeHRM.\n * If not, see <https://www.gnu.org/licenses/>.\n */\n -->\n\n<template>\n  <div class=\"orangehrm-background-container\">\n    <review-confirm-modal ref=\"confirmDialog\"> </review-confirm-modal>\n    <div class=\"orangehrm-card-container\">\n      <oxd-text tag=\"h5\" class=\"orangehrm-performance-review-title\">\n        {{ $t('performance.performance_review') }}\n      </oxd-text>\n    </div>\n    <br />\n    <review-summary\n      :loading=\"isLoading\"\n      :status=\"status\"\n      :due-date=\"dueDate\"\n      :employee=\"employee.details\"\n      :job-title=\"employee.jobTitle\"\n      :review-period-end=\"reviewPeriodEnd\"\n      :review-period-start=\"reviewPeriodStart\"\n      :final-rating=\"finalRating\"\n    />\n    <br />\n    <oxd-form ref=\"formRef\" :loading=\"isLoading\">\n      <evaluation-form\n        v-model=\"employeeReview\"\n        :kpis=\"kpis\"\n        :rules=\"rules\"\n        :editable=\"hasSupervisorUpdateAction\"\n        :collapsed=\"employee.status < 3\"\n        :collapsible=\"employee.status === 3\"\n        :employee=\"employee.details\"\n        :job-title=\"employee.jobTitle\"\n        :status=\"employee.status\"\n        :title=\"$t('performance.self_evaluation_by')\"\n      ></evaluation-form>\n      <br />\n      <evaluation-form\n        v-model=\"supervisorReview\"\n        :kpis=\"kpis\"\n        :rules=\"rules\"\n        :editable=\"hasSaveAction || hasCompleteAction\"\n        :collapsible=\"true\"\n        :employee=\"supervisor.details\"\n        :job-title=\"supervisor.jobTitle\"\n        :status=\"supervisor.status\"\n        :title=\"$t('performance.supervisor_evaluation_by')\"\n      >\n        <oxd-divider />\n        <final-evaluation\n          :key=\"isFinalizeRequired\"\n          v-model:final-rating=\"finalRating\"\n          v-model:final-comment=\"finalComment\"\n          v-model:completed-date=\"completedDate\"\n          :status=\"status\"\n          :is-required=\"isFinalizeRequired\"\n        />\n        <oxd-form-actions v-show=\"hasActions\">\n          <oxd-divider />\n          <div class=\"orangehrm-performance-review-actions\">\n            <oxd-button\n              v-if=\"hasCancelAction\"\n              display-type=\"ghost\"\n              :label=\"$t('general.cancel')\"\n              @click=\"onClickCancel\"\n            />\n            <oxd-button\n              v-if=\"hasSaveAction\"\n              display-type=\"ghost\"\n              type=\"button\"\n              :label=\"$t('general.save')\"\n              @click=\"onSubmit(false)\"\n            />\n            <oxd-button\n              v-if=\"hasCompleteAction\"\n              type=\"button\"\n              display-type=\"secondary\"\n              :label=\"$t('performance.complete')\"\n              @click=\"onSubmit(true)\"\n            />\n          </div>\n        </oxd-form-actions>\n      </evaluation-form>\n    </oxd-form>\n  </div>\n</template>\n\n<script>\nimport useForm from '@ohrm/core/util/composable/useForm';\nimport {APIService} from '@/core/util/services/api.service';\nimport {navigate, reloadPage} from '@/core/util/helper/navigation';\nimport ReviewSummary from '@/orangehrmPerformancePlugin/components/ReviewSummary';\nimport FinalEvaluation from '@/orangehrmPerformancePlugin/components/FinalEvaluation';\nimport EvaluationForm from '@/orangehrmPerformancePlugin/components/EvaluationForm';\nimport useReviewEvaluation from '@/orangehrmPerformancePlugin/util/composable/useReviewEvaluation';\nimport ReviewConfirmModal from '@/orangehrmPerformancePlugin/components/ReviewConfirmModal';\n\nconst reviewerModel = {\n  details: {\n    empNumber: null,\n    firstName: '',\n    lastName: '',\n    middleName: '',\n    terminationId: null,\n  },\n  jobTitle: '',\n  status: 1,\n  actions: new Map(),\n};\n\nexport default {\n  components: {\n    'review-summary': ReviewSummary,\n    'final-evaluation': FinalEvaluation,\n    'evaluation-form': EvaluationForm,\n    'review-confirm-modal': ReviewConfirmModal,\n  },\n  props: {\n    reviewId: {\n      type: Number,\n      required: true,\n    },\n    status: {\n      type: Number,\n      required: true,\n    },\n    reviewPeriodStart: {\n      type: String,\n      required: true,\n    },\n    reviewPeriodEnd: {\n      type: String,\n      required: true,\n    },\n    dueDate: {\n      type: String,\n      required: true,\n    },\n    isReviewer: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup() {\n    const {formRef, invalid, validate} = useForm();\n    const http = new APIService(window.appGlobal.baseUrl, '');\n\n    const {\n      getAllKpis,\n      getEmployeeReview,\n      getSupervisorReview,\n      getFinalReview,\n      generateRules,\n      generateModel,\n      generateReviewerData,\n      generateAllowedActions,\n      generateEvaluationFormData,\n      finalizeReview,\n      saveEmployeeReview,\n      saveSupervisorReview,\n    } = useReviewEvaluation(http);\n\n    return {\n      http,\n      invalid,\n      formRef,\n      validate,\n      getAllKpis,\n      generateRules,\n      generateModel,\n      generateReviewerData,\n      generateAllowedActions,\n      generateEvaluationFormData,\n      getEmployeeReview,\n      getSupervisorReview,\n      getFinalReview,\n      finalizeReview,\n      saveEmployeeReview,\n      saveSupervisorReview,\n    };\n  },\n  data() {\n    return {\n      kpis: [],\n      rules: [],\n      employee: {...reviewerModel},\n      employeeReview: {},\n      supervisor: {...reviewerModel},\n      supervisorReview: {},\n      isLoading: false,\n      finalRating: null,\n      finalComment: null,\n      completedDate: null,\n      isFinalizeRequired: false,\n    };\n  },\n  computed: {\n    hasSupervisorUpdateAction() {\n      return this.employee.actions.has('supervisorUpdate');\n    },\n    hasSaveAction() {\n      return this.supervisor.actions.has('save');\n    },\n    hasCompleteAction() {\n      return this.supervisor.actions.has('complete');\n    },\n    hasCancelAction() {\n      return this.status !== 4;\n    },\n    hasActions() {\n      return (\n        this.hasSupervisorUpdateAction ||\n        this.hasSaveAction ||\n        this.hasCompleteAction ||\n        this.hasCancelAction\n      );\n    },\n  },\n  beforeMount() {\n    this.isLoading = true;\n    this.getAllKpis(this.reviewId)\n      .then((response) => {\n        const {data} = response.data;\n        this.kpis = [...data];\n        this.rules = this.generateRules(data);\n        this.employeeReview = this.generateModel(data);\n        this.supervisorReview = this.generateModel(data);\n        return this.getEmployeeReview(this.reviewId);\n      })\n      .then((response) => {\n        const {data} = response.data;\n        const {meta} = response.data;\n        this.employee = this.generateReviewerData(meta.reviewer);\n        this.employee.actions = this.generateAllowedActions(\n          meta.allowedActions,\n        );\n        this.employeeReview = this.generateEvaluationFormData(\n          data,\n          meta.generalComment,\n          this.employeeReview.kpis,\n        );\n        return this.getSupervisorReview(this.reviewId);\n      })\n      .then((response) => {\n        const {data} = response.data;\n        const {meta} = response.data;\n        this.supervisor = this.generateReviewerData(meta.reviewer);\n        this.supervisor.actions = this.generateAllowedActions(\n          meta.allowedActions,\n        );\n        this.supervisorReview = this.generateEvaluationFormData(\n          data,\n          meta.generalComment,\n          this.supervisorReview.kpis,\n        );\n        return this.getFinalReview(this.reviewId);\n      })\n      .then((response) => {\n        const {data} = response.data;\n        this.finalRating = data.finalRating;\n        this.finalComment = data.finalComment;\n        this.completedDate = data.completedDate;\n      })\n      .finally(() => {\n        this.isLoading = false;\n      });\n  },\n  methods: {\n    onSubmit(complete = false) {\n      this.isFinalizeRequired = complete;\n      this.$nextTick()\n        .then(() => this.validate())\n        .then(() => {\n          if (this.invalid === true) return;\n          if (complete) {\n            this.$refs.confirmDialog.showDialog().then((confirmation) => {\n              if (confirmation === 'ok') {\n                this.submitReview(true);\n              }\n            });\n          } else {\n            this.submitReview(false);\n          }\n        });\n    },\n    submitReview(complete = false) {\n      this.isLoading = true;\n      this.saveSupervisorReview(this.reviewId, this.supervisorReview)\n        .then(() => {\n          if (this.hasSupervisorUpdateAction) {\n            return this.saveEmployeeReview(\n              this.reviewId,\n              true,\n              this.employeeReview,\n            );\n          }\n        })\n        .then(() => {\n          return this.finalizeReview(this.reviewId, {\n            complete: complete,\n            finalRating: this.finalRating,\n            finalComment: this.finalComment,\n            completedDate: this.completedDate,\n          });\n        })\n        .then(() => {\n          return this.$toast.saveSuccess();\n        })\n        .finally(() => {\n          reloadPage();\n        });\n    },\n    onClickCancel() {\n      navigate(\n        this.isReviewer\n          ? '/performance/searchEvaluatePerformanceReview'\n          : '/performance/searchPerformanceReview',\n      );\n    },\n  },\n};\n</script>\n\n<style src=\"./review-evaluate.scss\" lang=\"scss\" scoped></style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}